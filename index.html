<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema di tracciamento interventi meccanici - Tano Evoluzione">
    <meta name="theme-color" content="#2563eb">
    <title>Tano Evoluzione - Sistema NFC</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: url('Background.png') no-repeat center center fixed;
            background-size: cover;
            color: white;
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 1s ease-in-out forwards;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.65) 50%, rgba(0,0,0,0.85) 100%);
            backdrop-filter: blur(2px);
            z-index: -1;
        }
        #app {
            background: rgba(0,0,0,0.45);
            min-height: 100vh;
            padding-bottom: 50px;
        }
        .bg-white {
            background-color: rgba(30,30,35,0.88) !important;
            backdrop-filter: blur(12px) saturate(120%);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            transition: all 0.4s ease;
        }
        .bg-white p, .bg-white span, .bg-white h2, .bg-white h3 {
            color: #e5e7eb !important;
        }
        .text-gray-600, .text-gray-500, .text-gray-700 {
            color: #d1d5db !important;
        }
        .text-blue-600 {
            color: #60a5fa !important;
        }
        input, textarea, select {
            color: #f3f4f6 !important;
            background-color: rgba(45,45,50,0.95) !important;
            border: 2px solid rgba(75,85,99,0.8) !important;
        }
        input::placeholder, textarea::placeholder {
            color: #9ca3af !important;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(59,130,246,0.3);
            border-color: #3b82f6 !important;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="app">Caricamento...</div>

    <script>
        // ========== CONFIGURATION ==========
        const MECHANIC_PIN = "1234"; // Code PIN m√©canicien (modifiable)
        
        // ========== VARIABLES GLOBALES ==========
        let vehicles = {};
        let currentVehicle = null;
        let showAddForm = false;
        let isMechanicMode = false;
        let isClientMode = false;
        let showLoginScreen = true;

        // ========== G√âN√âRATION CODE CLIENT ==========
        function generateClientCode(targa) {
            // Format: TARGA-ANN√âE
            const year = new Date().getFullYear();
            return `${targa}-${year}`;
        }

        // ========== V√âRIFICATION CODE CLIENT ==========
        function verifyClientCode(code) {
            const parts = code.toUpperCase().split('-');
            if (parts.length !== 2) return null;
            
            const targa = parts[0];
            const year = parts[1];
            const currentYear = new Date().getFullYear().toString();
            
            // Accepter l'ann√©e actuelle et l'ann√©e pr√©c√©dente
            const lastYear = (currentYear - 1).toString();
            
            if ((year === currentYear || year === lastYear) && vehicles[targa]) {
                return targa;
            }
            return null;
        }

        // ========== CHARGER DONN√âES ==========
        function loadData() {
            try {
                const stored = localStorage.getItem('garage_vehicles');
                if (stored) {
                    vehicles = JSON.parse(stored);
                }
            } catch (error) {
                console.log('Premi√®re utilisation');
                vehicles = {};
            }
        }

        // ========== SAUVEGARDER DONN√âES ==========
        function saveData() {
            try {
                localStorage.setItem('garage_vehicles', JSON.stringify(vehicles));
            } catch (error) {
                console.error('Erreur de sauvegarde:', error);
                alert('Errore durante il salvataggio');
            }
        }

        // ========== AUTHENTIFICATION ==========
        function login() {
            const code = document.getElementById('loginCode').value.trim();
            
            if (!code) {
                alert('Inserisci un codice');
                return;
            }

            // V√©rifier si c'est le code m√©canicien
            if (code === MECHANIC_PIN) {
                isMechanicMode = true;
                isClientMode = false;
                showLoginScreen = false;
                currentVehicle = null;
                render();
                return;
            }

            // V√©rifier si c'est un code client
            const targa = verifyClientCode(code);
            if (targa) {
                isClientMode = true;
                isMechanicMode = false;
                showLoginScreen = false;
                currentVehicle = targa;
                render();
                return;
            }

            alert('Codice non valido');
        }

        // ========== D√âCONNEXION ==========
        function logout() {
            isMechanicMode = false;
            isClientMode = false;
            showLoginScreen = true;
            currentVehicle = null;
            showAddForm = false;
            render();
        }

        // ========== AJOUTER V√âHICULE ==========
        function addVehicle() {
            if (!isMechanicMode) {
                alert('Accesso negato');
                return;
            }

            const targa = document.getElementById('newVehicleTarga').value.toUpperCase().trim();
            const marca = document.getElementById('newVehicleMarca').value.trim();
            const modello = document.getElementById('newVehicleModello').value.trim();
            const anno = document.getElementById('newVehicleAnno').value.trim();
            const km = document.getElementById('newVehicleKm').value.trim();

            if (!targa) {
                alert('Targa obbligatoria');
                return;
            }

            vehicles[targa] = {
                targa: targa,
                marca: marca,
                modello: modello,
                anno: anno,
                chilometraggio: km,
                interventi: [],
                clientCode: generateClientCode(targa),
                createdAt: new Date().toISOString()
            };

            saveData();
            currentVehicle = targa;
            render();
        }

        // ========== AJOUTER INTERVENTION ==========
        function addIntervento() {
            if (!isMechanicMode) {
                alert('Accesso negato');
                return;
            }

            const data = document.getElementById('interventoData').value;
            const tipo = document.getElementById('interventoTipo').value;
            const descrizione = document.getElementById('interventoDesc').value;
            const ricambi = document.getElementById('interventoRicambi').value;
            const costo = document.getElementById('interventoCosto').value;
            const km = document.getElementById('interventoKm').value;
            const meccanico = document.getElementById('interventoMeccanico').value;
            const note = document.getElementById('interventoNote').value;

            if (!tipo || !descrizione) {
                alert('Tipo e descrizione obbligatori');
                return;
            }

            const intervento = {
                id: Date.now(),
                data: data,
                tipo: tipo,
                descrizione: descrizione,
                ricambi: ricambi,
                costo: costo,
                chilometraggio: km,
                meccanico: meccanico,
                note: note,
                timestamp: new Date().toISOString()
            };

            vehicles[currentVehicle].interventi.unshift(intervento);
            
            if (km) {
                vehicles[currentVehicle].chilometraggio = km;
            }

            saveData();
            showAddForm = false;
            render();
        }

        // ========== SUPPRIMER INTERVENTION ==========
        function deleteIntervento(id) {
            if (!isMechanicMode) {
                alert('Accesso negato');
                return;
            }

            if (!confirm('Eliminare questo intervento?')) return;
            
            vehicles[currentVehicle].interventi = 
                vehicles[currentVehicle].interventi.filter(i => i.id !== id);
            
            saveData();
            render();
        }

        // ========== SUPPRIMER V√âHICULE ==========
        function deleteVehicle(targa) {
            if (!isMechanicMode) {
                alert('Accesso negato');
                return;
            }

            if (!confirm(`Eliminare definitivamente il veicolo ${targa}?`)) return;
            
            delete vehicles[targa];
            saveData();
            render();
        }

        // ========== AFFICHER CODE CLIENT ==========
        function showClientCode(targa) {
            const vehicle = vehicles[targa];
            const code = vehicle.clientCode || generateClientCode(targa);
            
            // Mettre √† jour le code si pas pr√©sent
            if (!vehicle.clientCode) {
                vehicle.clientCode = code;
                saveData();
            }

            const message = `
CODICE CLIENTE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Veicolo: ${targa}
${vehicle.marca} ${vehicle.modello}

Codice: ${code}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Comunica questo codice al cliente.
Il cliente potr√† vedere solo lo storico del suo veicolo.
            `.trim();

            alert(message);

            // Copier dans le presse-papier
            if (navigator.clipboard) {
                navigator.clipboard.writeText(code).then(() => {
                    console.log('Codice copiato');
                });
            }
        }

        // ========== EXPORT CSV ==========
        function exportToExcel() {
            const vehicle = vehicles[currentVehicle];
            let csv = "Data;Tipo;Descrizione;Ricambi;Costo;Chilometraggio;Meccanico;Note\n";
            
            (vehicle.interventi || []).forEach(inter => {
                csv += `${inter.data || ''};`;
                csv += `${inter.tipo || ''};`;
                csv += `${(inter.descrizione || '').replace(/;/g, ',')};`;
                csv += `${(inter.ricambi || '').replace(/;/g, ',')};`;
                csv += `${inter.costo || ''};`;
                csv += `${inter.chilometraggio || ''};`;
                csv += `${inter.meccanico || ''};`;
                csv += `${(inter.note || '').replace(/;/g, ',')}\n`;
            });

            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
            element.setAttribute('download', vehicle.targa + '.csv');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // ========== RENDER ==========
        function render() {
            const app = document.getElementById('app');

            // √âCRAN DE CONNEXION
            if (showLoginScreen) {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
                            <img src="logo.png" alt="TANO Logo" class="h-24 w-24 mx-auto mb-6 object-contain" onerror="this.style.display='none'">
                            <h1 class="text-3xl font-bold mb-2 text-center">Tano Evoluzione</h1>
                            <p class="text-gray-400 mb-8 text-center">Bosch car Service</p>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Inserisci il codice:</label>
                                    <input 
                                        type="text" 
                                        id="loginCode" 
                                        placeholder="Codice Meccanico o Cliente"
                                        class="w-full px-4 py-3 border-2 rounded-lg text-center text-xl font-bold uppercase"
                                        onkeypress="if(event.key==='Enter') login()"
                                    >
                                </div>
                                
                                <button onclick="login()" class="w-full bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-700">
                                    üîì Accedi
                                </button>

                                <div class="mt-6 pt-6 border-t border-gray-700">
                                    <p class="text-xs text-gray-500 text-center">
                                        üîß <strong>Meccanico:</strong> Usa il PIN<br>
                                        üë§ <strong>Cliente:</strong> Usa il codice ricevuto
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // MODE M√âCANICIEN - Liste v√©hicules
            if (!currentVehicle && isMechanicMode) {
                const vehiclesList = Object.values(vehicles);
                
                app.innerHTML = `
                    <div class="min-h-screen">
                        <div class="bg-blue-600 text-white p-4 shadow-lg">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <img src="logo.png" alt="TANO" class="h-12 w-12 object-contain rounded-lg bg-white p-1" onerror="this.style.display='none'">
                                    <div>
                                        <h1 class="text-2xl font-bold">Tano Evoluzione</h1>
                                        <p class="text-xs text-blue-100">üîß Modo Meccanico</p>
                                    </div>
                                </div>
                                <button onclick="logout()" class="px-4 py-2 bg-red-500 rounded hover:bg-red-600 font-semibold">
                                    Esci
                                </button>
                            </div>
                        </div>

                        <div class="p-4">
                            <div class="bg-white rounded-lg shadow p-4 mb-4">
                                <h2 class="text-lg font-bold mb-3">‚ûï Nuovo Veicolo</h2>
                                <div class="space-y-2">
                                    <input type="text" id="newVehicleTarga" placeholder="Targa *" class="w-full px-3 py-2 border rounded uppercase font-bold">
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="text" id="newVehicleMarca" placeholder="Marca" class="px-3 py-2 border rounded">
                                        <input type="text" id="newVehicleModello" placeholder="Modello" class="px-3 py-2 border rounded">
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" id="newVehicleAnno" placeholder="Anno" class="px-3 py-2 border rounded">
                                        <input type="number" id="newVehicleKm" placeholder="Chilometraggio" class="px-3 py-2 border rounded">
                                    </div>
                                    <button onclick="addVehicle()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">
                                        Aggiungi Veicolo
                                    </button>
                                </div>
                            </div>

                            <h2 class="text-xl font-bold mb-3 text-white">üöó Veicoli (${vehiclesList.length})</h2>
                            
                            ${vehiclesList.length === 0 ? `
                                <div class="bg-white rounded-lg shadow p-8 text-center text-gray-400">
                                    <p>Nessun veicolo registrato</p>
                                </div>
                            ` : `
                                <div class="space-y-3">
                                    ${vehiclesList.map(v => `
                                        <div class="bg-white rounded-lg shadow p-4">
                                            <div class="flex justify-between items-center">
                                                <div class="flex-1 cursor-pointer" onclick="currentVehicle='${v.targa}'; render();">
                                                    <span class="text-xl font-bold">${v.targa}</span>
                                                    <p class="text-gray-400">${v.marca} ${v.modello} ${v.anno ? `(${v.anno})` : ''}</p>
                                                    ${v.chilometraggio ? `<p class="text-sm text-gray-500">${v.chilometraggio} km</p>` : ''}
                                                </div>
                                                <div class="flex gap-2">
                                                    <button onclick="showClientCode('${v.targa}')" class="bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 font-semibold" title="Codice Cliente">
                                                        üë§ Codice
                                                    </button>
                                                    <button onclick="deleteVehicle('${v.targa}')" class="text-red-500 hover:bg-red-50 px-3 py-2 rounded text-sm font-bold">
                                                        ‚úï
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
                return;
            }

            // D√âTAIL V√âHICULE (M√©canicien ou Client)
            const vehicle = vehicles[currentVehicle];
            if (!vehicle) {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="bg-white rounded-lg shadow p-8 text-center">
                            <p class="text-gray-400 mb-4">Veicolo non trovato</p>
                            <button onclick="logout()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
                                Torna all'accesso
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            if (!showAddForm) {
                app.innerHTML = `
                    <div class="min-h-screen">
                        <div class="bg-blue-600 text-white p-4 shadow-lg">
                            <div class="flex justify-between items-center mb-2">
                                ${isMechanicMode ? `
                                    <button onclick="currentVehicle=null; render();" class="hover:bg-blue-700 px-3 py-2 rounded">
                                        ‚Üê Indietro
                                    </button>
                                ` : ''}
                                <button onclick="logout()" class="px-3 py-2 bg-red-500 rounded hover:bg-red-600 text-sm">
                                    Esci
                                </button>
                            </div>
                            <div class="flex items-center gap-3">
                                <img src="logo.png" alt="TANO" class="h-10 w-10 object-contain rounded-lg bg-white p-1" onerror="this.style.display='none'">
                                <div>
                                    <h1 class="text-2xl font-bold">${vehicle.targa}</h1>
                                    <p class="text-blue-100">${vehicle.marca} ${vehicle.modello} ${vehicle.anno ? `(${vehicle.anno})` : ''}</p>
                                    ${vehicle.chilometraggio ? `<p class="text-sm text-blue-100">üìç ${vehicle.chilometraggio} km</p>` : ''}
                                </div>
                            </div>
                        </div>

                        <div class="p-4">
                            ${isMechanicMode ? `
                                <button onclick="showAddForm=true; render();" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold mb-4 hover:bg-green-700">
                                    ‚ûï Nuovo Intervento
                                </button>
                                <button onclick="exportToExcel()" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 mb-4">
                                    üìä Esporta CSV
                                </button>
                            ` : `
                                <div class="bg-blue-900 bg-opacity-50 text-white p-4 rounded-lg mb-4 text-center border border-blue-500">
                                    <p class="text-sm font-semibold">üë§ Modalit√† Cliente - Solo Lettura</p>
                                    <p class="text-xs text-blue-200 mt-1">Puoi consultare lo storico ma non modificare</p>
                                </div>
                            `}

                            <h2 class="text-xl font-bold mb-3 text-white">üìã Storico (${(vehicle.interventi || []).length})</h2>

                            ${(vehicle.interventi || []).length === 0 ? `
                                <div class="bg-white rounded-lg shadow p-8 text-center text-gray-400">
                                    <svg class="mx-auto mb-3 opacity-50" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" stroke-width="2"/>
                                    </svg>
                                    <p>Nessun intervento registrato</p>
                                </div>
                            ` : `
                                <div class="space-y-3">
                                    ${(vehicle.interventi || []).map(inter => `
                                        <div class="bg-white rounded-lg shadow p-4">
                                            <div class="flex justify-between items-start mb-2">
                                                <div class="flex-1">
                                                    <div class="text-sm text-gray-400 mb-1">üìÖ ${inter.data || 'Data non specificata'}</div>
                                                    <h3 class="font-bold text-lg text-blue-400">${inter.tipo}</h3>
                                                </div>
                                                ${isMechanicMode ? `
                                                    <button onclick="deleteIntervento(${inter.id})" class="text-red-500 hover:bg-red-50 px-2 py-1 rounded text-sm font-bold">‚úï</button>
                                                ` : ''}
                                            </div>
                                            <p class="text-gray-300 mb-2">${inter.descrizione}</p>
                                            ${inter.ricambi ? `<div class="text-sm text-gray-400 mb-1"><span class="font-semibold">üîß Ricambi:</span> ${inter.ricambi}</div>` : ''}
                                            ${inter.note ? `
                                                <div class="bg-yellow-900 bg-opacity-30 border-l-4 border-yellow-500 p-3 mt-2 rounded">
                                                    <p class="text-sm text-gray-300"><span class="font-semibold">üí¨ Note:</span> ${inter.note}</p>
                                                </div>
                                            ` : ''}
                                            <div class="flex flex-wrap gap-3 mt-2 text-sm">
                                                ${inter.costo ? `<div class="text-green-400 font-semibold">üí∞ ${inter.costo} ‚Ç¨</div>` : ''}
                                                ${inter.chilometraggio ? `<div class="text-gray-400 font-semibold">üìç ${inter.chilometraggio} km</div>` : ''}
                                                ${inter.meccanico ? `<div class="text-gray-400">üë§ ${inter.meccanico}</div>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else {
                // FORMULAIRE AJOUT INTERVENTION
                const today = new Date().toISOString().split('T')[0];
                app.innerHTML = `
                    <div class="min-h-screen">
                        <div class="bg-blue-600 text-white p-4 shadow-lg">
                            <div class="flex items-center gap-3">
                                <img src="logo.png" alt="TANO" class="h-10 w-10 object-contain rounded-lg bg-white p-1" onerror="this.style.display='none'">
                                <div>
                                    <h1 class="text-xl font-bold">${vehicle.targa}</h1>
                                    <p class="text-blue-100">‚ûï Nuovo Intervento</p>
                                </div>
                            </div>
                        </div>

                        <div class="p-4">
                            <div class="bg-white rounded-lg shadow p-4">
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üìÖ Data *</label>
                                        <input type="date" id="interventoData" value="${today}" class="w-full px-3 py-2 border rounded">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üîß Tipo *</label>
                                        <select id="interventoTipo" class="w-full px-3 py-2 border rounded">
                                            <option value="">Seleziona...</option>
                                            <option value="Cambio Olio">Cambio Olio</option>
                                            <option value="Filtro Olio">Filtro Olio</option>
                                            <option value="Filtro Aria">Filtro Aria</option>
                                            <option value="Filtro Carburante">Filtro Carburante</option>
                                            <option value="Filtro Abitacolo">Filtro Abitacolo</option>
                                            <option value="Candele">Candele</option>
                                            <option value="Distribuzione">Distribuzione</option>
                                            <option value="Freni">Freni</option>
                                            <option value="Pneumatici">Pneumatici</option>
                                            <option value="Frizione">Frizione</option>
                                            <option value="Revisione">Revisione</option>
                                            <option value="Aria Condizionata">Aria Condizionata</option>
                                            <option value="Diagnostica">Diagnostica</option>
                                            <option value="Carrozzeria">Carrozzeria</option>
                                            <option value="Elettrico/Elettrauto">Elettrico/Elettrauto</option>
                                            <option value="Sospensioni">Sospensioni</option>
                                            <option value="Scarico">Scarico</option>
                                            <option value="Altro">Altro</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üìù Descrizione *</label>
                                        <textarea id="interventoDesc" rows="3" placeholder="Dettagli intervento..." class="w-full px-3 py-2 border rounded"></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üî© Ricambi</label>
                                        <input type="text" id="interventoRicambi" placeholder="Es: Pastiglie anteriori..." class="w-full px-3 py-2 border rounded">
                                    </div>

                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-semibold mb-1">üí∞ Costo (‚Ç¨)</label>
                                            <input type="number" id="interventoCosto" step="0.01" placeholder="0.00" class="w-full px-3 py-2 border rounded">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold mb-1">üìç Km</label>
                                            <input type="number" id="interventoKm" value="${vehicle.chilometraggio || ''}" placeholder="km" class="w-full px-3 py-2 border rounded">
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üë§ Meccanico</label>
                                        <input type="text" id="interventoMeccanico" placeholder="Nome meccanico" class="w-full px-3 py-2 border rounded">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-semibold mb-1">üí¨ Note</label>
                                        <textarea id="interventoNote" rows="3" placeholder="Osservazioni, raccomandazioni..." class="w-full px-3 py-2 border rounded"></textarea>
                                    </div>

                                    <div class="flex gap-2 pt-2">
                                        <button onclick="addIntervento()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                                            ‚úÖ Salva
                                        </button>
                                        <button onclick="showAddForm=false; render();" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700">
                                            ‚ùå Annulla
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ========== D√âMARRAGE ==========
        loadData();
        render();
        
        // Service Worker pour PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('‚úÖ Service Worker OK'))
                    .catch(err => console.log('‚ùå SW Error:', err));
            });
        }
    </script>
</body>
</html>
